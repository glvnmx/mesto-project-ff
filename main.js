(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-42",headers:{authorization:"e611e539-e018-4090-bf23-2a9de30f0388","Content-Type":"application/json"}},t=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},n=function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then(t)},o=function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then(t)};function r(n,o){var r;(r=n,fetch("".concat(e.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:e.headers}).then(t)).then((function(){o.remove()})).catch((function(e){console.error("Ошибка удаления карточки",e)}))}function c(e,t,r){(t?o:n)(e).then((function(e){r(e.likes)})).catch((function(e){console.error("Ошибка лайка карточки",e)}))}function a(e,t,n,o,r){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__like-button"),u=c.querySelector(".card__image"),i=c.querySelector(".card__title"),s=c.querySelector(".card__delete-button"),l=c.querySelector(".card__like-counter");return u.src=e.link,u.alt=e.name,i.textContent=e.name,l.textContent=e.likes.length,e.likes.some((function(e){return e._id===r}))&&a.classList.add("card__like-button_is-active"),a.addEventListener("click",(function(){var t=a.classList.contains("card__like-button_is-active");n(e._id,t,(function(e){l.textContent=e.length,a.classList.toggle("card__like-button_is-active")}))})),e.owner._id!==r?s.remove():s.addEventListener("click",(function(){t(e._id,c)})),u.addEventListener("click",(function(){o(e.link,e.name)})),c}var u,i=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");l(t)}},s=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keyup",i)},l=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",i)},p=function(e){e.querySelector(".popup__close").addEventListener("click",(function(){return l(e)})),e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&l(e)}))},d=function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.classList.remove("popup__error-visible"),n.textContent=""},_=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove("popup__button-disabled")):(t.classList.add("popup__button-disabled"),t.disabled=!0)},f=function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");t.forEach((function(t){t.setCustomValidity(""),d(e,t)})),_(t,n)},m=document.querySelector(".places__list"),y=document.querySelector(".profile__edit-button"),v=document.querySelector(".profile__add-button"),h=document.querySelector(".profile__image"),b=document.querySelector(".popup_type_edit"),S=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_change-avatar"),L=document.querySelector(".popup__form-edit"),k=document.querySelector(".popup__form-card"),E=document.querySelector(".popup__form-avatar"),g=L.querySelector(".popup__input_type_name"),C=L.querySelector(".popup__input_type_description"),x=k.querySelector(".popup__input_type_card-name"),U=k.querySelector(".popup__input_type_url"),A=E.querySelector(".popup__input_type_avatar"),T=document.querySelector(".popup_type_image"),D=T.querySelector(".popup__image"),P=T.querySelector(".popup__caption"),w=document.querySelector(".profile__title"),N=document.querySelector(".profile__description");function O(e,t){e.textContent=t?"Сохранение...":"Сохранить"}function V(e,t){D.src=e,D.alt=t,P.textContent=t,s(T)}Array.from(document.querySelectorAll("form")).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");_(t,n),t.forEach((function(o){o.addEventListener("input",(function(){!function(e,t){var n=t.dataset.errorMessage;n?/^[A-Za-zа-яА-ЯёЁ\s\-]+$/.test(t.value)?t.setCustomValidity(""):t.setCustomValidity(n||"Недопустимые символы"):t.setCustomValidity(""),t.validity.valid?d(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),o.textContent=n,o.classList.add("popup__error-visible")}(e,t,t.validationMessage)}(e,o),_(t,n)}))}))}(e)})),k.addEventListener("submit",(function(n){n.preventDefault();var o,i=n.target.querySelector(".popup__button");O(i,!0),(o={name:x.value,link:U.value},fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:o.name,link:o.link})}).then(t)).then((function(e){var t=a(e,r,c,V,u);m.prepend(t),l(S),k.reset()})).catch((function(e){console.error("Произошла ошибка при добавлении карточки",e)})).finally((function(){O(i,!1)}))})),L.addEventListener("submit",(function(n){n.preventDefault();var o=n.target.querySelector(".popup__button");O(o,!0);var r,c=C.value;(r={name:g.value,about:c},fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:r.name,about:r.about})}).then(t)).then((function(e){w.textContent=e.name,N.textContent=e.about,L.reset(),l(b)})).catch((function(e){console.error("Произошла ошибка при отправке данных пользователя",e)})).finally((function(){O(o,!1)}))})),p(b),p(S),p(T),p(q),y.addEventListener("click",(function(){g.value=w.textContent,C.value=N.textContent,f(L),s(b)})),v.addEventListener("click",(function(){f(k),s(S),k.reset()})),h.addEventListener("click",(function(){f(E),s(q),E.reset()})),E.addEventListener("submit",(function(n){n.preventDefault();var o,r=n.target.querySelector(".popup__button");O(r,!0),(o={avatar:A.value},fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o.avatar})}).then(t)).then((function(e){h.style.backgroundImage="url(".concat(e.avatar,")"),l(q),E.reset()})).catch((function(e){console.error("Произошла ошибка при загрузке данных пользователя",e)})).finally((function(){O(r,!1)}))})),fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t).then((function(e){w.textContent=e.name,N.textContent=e.about,h.style.backgroundImage="url(".concat(e.avatar,")"),u=e._id})).catch((function(e){console.error("Произошла ошибка при загрузке данных пользователя",e)})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t).then((function(e){e.reverse().forEach((function(e){m.appendChild(a(e,r,c,V,u))}))})).catch((function(e){console.error("Произошла ошибка при загрузке карточек",e)}))})();